---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/Container.astro';
import Card from '@/components/Card.astro';
import CardTitle from '@/components/CardTitle.astro';
import CardDescription from '@/components/CardDescription.astro';
import CardEyebrow from '@/components/CardEyebrow.astro';
import CardCta from '@/components/CardCta.astro';
import Photos from '@/components/Photos.astro';
import Newsletter from '@/components/Newsletter.astro';
import Resume from '@/components/Resume.astro';
import SocialLinks from '@/components/SocialLinks.astro';
import { formatDate } from '@/utils/formatDate';

const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()).slice(0, 4);
---

<BaseLayout title="Home">
  <Container className="mt-9">
    <div class="max-w-2xl">
      <h1 class="text-4xl font-bold tracking-tight text-zinc-800 sm:text-5xl dark:text-zinc-100">
        Software designer, founder, and amateur astronaut.
      </h1>
      <p class="mt-6 text-base text-zinc-600 dark:text-zinc-400">
        I'm Spencer, a software designer and entrepreneur based in New York
        City. I'm the founder and CEO of Planetaria, where we develop
        technologies that empower regular people to explore space on their
        own terms.
      </p>
      <div class="mt-6 flex gap-6">
        <SocialLinks />
      </div>
    </div>
  </Container>

  <Photos />

  <Container className="mt-24 md:mt-28">
    <div class="mx-auto grid max-w-xl grid-cols-1 gap-y-20 lg:max-w-none lg:grid-cols-2">
      <div class="flex flex-col gap-16">
        {posts.map((post) => (
          <Card as="article">
            <CardEyebrow as="time" dateTime={post.data.pubDate.toISOString()} decorate>
              {formatDate(post.data.pubDate)}
            </CardEyebrow>
            <CardTitle href={`/blog/${post.id}`}>
              {post.data.title}
            </CardTitle>
            <CardDescription>
              {post.data.description}
            </CardDescription>
            <CardCta>Read article</CardCta>
          </Card>
        ))}
      </div>
      <div class="space-y-10 lg:pl-16 xl:pl-24">
        <Newsletter />
        <Resume />
      </div>
    </div>
  </Container>
</BaseLayout>
