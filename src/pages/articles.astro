---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/Container.astro';
import Card from '@/components/Card.astro';
import CardTitle from '@/components/CardTitle.astro';
import CardDescription from '@/components/CardDescription.astro';
import CardEyebrow from '@/components/CardEyebrow.astro';
import CardCta from '@/components/CardCta.astro';
import { formatDate } from '@/utils/formatDate';

const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title="Articles">
  <Container className="mt-16 sm:mt-32">
    <header class="max-w-2xl">
      <h1 class="text-4xl font-bold tracking-tight text-zinc-800 sm:text-5xl dark:text-zinc-100">
        Writing on software design, company building, and the aerospace industry.
      </h1>
      <p class="mt-6 text-base text-zinc-600 dark:text-zinc-400">
        All of my long-form thoughts on programming, leadership, product design, and more, collected in chronological order.
      </p>
    </header>
    <div class="mt-16 sm:mt-20 md:border-l md:border-zinc-100 md:pl-6 md:dark:border-zinc-700/40">
      <div class="flex max-w-3xl flex-col space-y-16">
        {posts.map((post) => (
          <article class="md:grid md:grid-cols-4 md:items-baseline">
            <Card className="md:col-span-3" as="div">
              <CardTitle href={`/blog/${post.id}`}>
                {post.data.title}
              </CardTitle>
              <CardEyebrow as="time" dateTime={post.data.pubDate.toISOString()} className="md:hidden" decorate>
                {formatDate(post.data.pubDate)}
              </CardEyebrow>
              <CardDescription>
                {post.data.description}
              </CardDescription>
              <CardCta>Read article</CardCta>
            </Card>
            <CardEyebrow as="time" dateTime={post.data.pubDate.toISOString()} className="mt-1 max-md:hidden">
              {formatDate(post.data.pubDate)}
            </CardEyebrow>
          </article>
        ))}
      </div>
    </div>
  </Container>
</BaseLayout>
