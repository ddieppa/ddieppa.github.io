---
import ThemeToggle from './ThemeToggle.astro';

const navLinks = [
  { href: '/', label: 'Blog' },
  { href: '/about', label: 'About' },
  { href: '/resume', label: 'Resume' },
  { href: '/uses', label: 'Uses' },
];

const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 backdrop-blur-md border-b" style="background-color: color-mix(in srgb, var(--bg-primary) 80%, transparent); border-color: var(--border-color);">
  <nav class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-2 font-bold text-xl group">
      <div id="header-avatar" class="relative w-8 h-8 rounded-lg overflow-hidden ring-2 ring-[var(--bg-tertiary)] transition-transform group-hover:scale-110 bg-gradient-to-br from-[var(--gradient-start)] to-[var(--gradient-end)] flex items-center justify-center">
        <img 
          id="header-profile-img"
          src="/profile.jpg" 
          alt="Daniel Dieppa"
          class="w-full h-full object-cover hidden"
        />
        <span id="header-fallback" class="text-white text-xs font-bold">DD</span>
      </div>
      <span class="hidden sm:inline gradient-text">Daniel Dieppa</span>
    </a>
    
    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-1">
      {navLinks.map(link => (
        <a 
          href={link.href}
          class:list={[
            'px-4 py-2 rounded-lg text-sm font-medium transition-colors',
            currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href))
              ? 'bg-[var(--bg-tertiary)]'
              : 'hover:bg-[var(--bg-tertiary)]'
          ]}
          style={currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) 
            ? 'color: var(--text-primary)' 
            : 'color: var(--text-secondary)'}
        >
          {link.label}
        </a>
      ))}
    </div>
    
    <!-- Right Side Actions -->
    <div class="flex items-center gap-2">
      <!-- Search Button -->
      <button 
        id="search-trigger"
        type="button" 
        class="p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)] hidden sm:flex items-center gap-2 text-sm"
        style="color: var(--text-secondary);"
        aria-label="Search"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <span class="hidden lg:inline">Search</span>
        <kbd class="hidden lg:inline px-1.5 py-0.5 rounded text-xs font-mono" style="background-color: var(--bg-tertiary);">âŒ˜K</kbd>
      </button>
      
      <ThemeToggle />
      
      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-btn"
        type="button" 
        class="p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)] md:hidden"
        aria-label="Open menu"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </nav>
  
  <!-- Mobile Menu -->
  <div 
    id="mobile-menu" 
    class="hidden md:hidden border-t px-4 py-4"
    style="border-color: var(--border-color);"
  >
    <div class="flex flex-col gap-1">
      {navLinks.map(link => (
        <a 
          href={link.href}
          class:list={[
            'px-4 py-3 rounded-lg font-medium transition-colors',
            currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href))
              ? 'bg-[var(--bg-tertiary)]'
              : 'hover:bg-[var(--bg-tertiary)]'
          ]}
          style={currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) 
            ? 'color: var(--text-primary)' 
            : 'color: var(--text-secondary)'}
        >
          {link.label}
        </a>
      ))}
    </div>
  </div>
</header>

<script>
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  
  mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });
  
  // Handle profile image fallback
  const headerImg = document.getElementById('header-profile-img') as HTMLImageElement | null;
  const headerFallback = document.getElementById('header-fallback');
  
  if (headerImg && headerFallback) {
    headerImg.addEventListener('load', () => {
      headerImg.classList.remove('hidden');
      headerFallback.classList.add('hidden');
    });
    
    headerImg.addEventListener('error', () => {
      headerImg.classList.add('hidden');
      headerFallback.classList.remove('hidden');
    });
    
    // Check if image loads on page load
    if (headerImg.complete && headerImg.naturalHeight !== 0) {
      headerImg.classList.remove('hidden');
      headerFallback.classList.add('hidden');
    }
  }
</script>

