---
interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  headings: Heading[];
}

const { headings } = Astro.props;
const filteredHeadings = headings.filter(h => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
  <nav class="toc">
    <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: var(--text-tertiary);">
      On this page
    </h3>
    <ul class="space-y-2 text-sm">
      {filteredHeadings.map(heading => (
        <li class:list={[heading.depth === 3 && 'ml-4']}>
          <a 
            href={`#${heading.slug}`}
            class="toc-link block py-1 transition-colors hover:text-(--gradient-start)"
            style="color: var(--text-secondary);"
            data-slug={heading.slug}
          >
            {heading.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}

<script>
  function setupTOC() {
    const tocLinks = document.querySelectorAll('.toc-link');
    const headings = document.querySelectorAll('article h2[id], article h3[id]');
    
    if (tocLinks.length === 0 || headings.length === 0) return;
    
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            tocLinks.forEach(link => {
              link.classList.remove('active');
              (link as HTMLElement).style.color = 'var(--text-secondary)';
            });
            
            const activeLink = document.querySelector(`[data-slug="${entry.target.id}"]`);
            if (activeLink) {
              activeLink.classList.add('active');
              (activeLink as HTMLElement).style.color = 'var(--gradient-start)';
            }
          }
        });
      },
      { rootMargin: '-80px 0px -80% 0px' }
    );
    
    headings.forEach(heading => observer.observe(heading));
  }
  
  document.addEventListener('astro:page-load', setupTOC);
  setupTOC();
</script>

<style>
  .toc-link.active {
    font-weight: 500;
  }
</style>







